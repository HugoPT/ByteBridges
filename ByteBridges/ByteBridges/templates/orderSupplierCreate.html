{% extends 'forms.html' %}
{% block formTitle %}
    <h1 class="title">Criar Encomenda</h1>
{% endblock %}

{% block formContent %}
    <form id="dataForm">
      <div class="form-field col-lg-6">
    <div class="mainbox">
      <div class="formDrop">
        <select id="supplier" name="idsupplier" class="dropstyle">
          {% for s in suppliers %}
          <option class="dropOptions" value="{{ s.idsupplier}}">
            {{ s.name}}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>

<div class="form-field col-lg-6">
    <div class="mainbox">
      <div class="formDrop">
        <select id="warehouse" name="idwarehouse" class="dropstyle">
          {% for w in warehouses %}
          <option class="dropOptions" value="{{ w.idwarehouse}}">
            {{ w.name}}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>
<div class="form-field col-lg-6">
    <div class="mainbox">
      <div class="formDrop">
        <select id="component" name="component" class="dropstyle">
          {% for c in component %}
          <option class="dropOptions" value="{{ c.component}}">
            {{ c.name}}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>
<div class="form-field col-lg-12">
    <label class="areaLabel" for="obs">Observações:</label>
    <textarea id="obs"
              class="input-text js-input"
              name="obs"
              ></textarea><br />
  </div>


<div class="form-field col-lg-4">
    <div class="mainbox">
      <div class="formDrop">
        <select id="family" name="idfamily" class="dropstyle">
          {% for f in families %}
          <option class="dropOptions" value="{{ f.idfamily}}">
            {{ f.name}}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>
        <div class="form-group">
            <div class="col-md12">
                <button class="bnt btn-success form-control" type="button" onclick="addDataRow()">Adicionar Produto
                </button>
            </div>
        </div>

    </form>

    <!-- DataTables Table -->
    <table id="dataTable" class="display">
        <thead>
        <tr>
            <th>Componente</th>
            <th>Referência</th>
            <th>Qtd</th>
            <th>Opções</th>
        </tr>
        </thead>
        <tbody>
        <!-- Existing data rows will go here -->
        </tbody>
    </table>
    <button class="bnt btn-primary form-control" id="creatDoc" type="button" >Criar encomenda </button>



    <script>
        var table;

        // Initialize DataTables
        $(document).ready(function () {
            table = $('#dataTable').DataTable({
                dom: "Bfrtip",
                buttons: ["copyHtml5", "excelHtml5", "csvHtml5", "pdfHtml5"],
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.13.7/i18n/pt-PT.json",
                },
            });

            // Add event listener for edit and delete buttons
            $('#dataTable tbody').on('click', 'button.edit', function () {
                var data = table.row($(this).parents('tr')).data();
                editDataRow(data);
                toggleButtonClass()
            });

            $('#dataTable tbody').on('click', 'button.delete', function () {
                table.row($(this).parents('tr')).remove().draw();
                toggleButtonClass()
            });
        });

        function toggleButtonClass() {
            var button = document.getElementById('creatDoc');
            if (table.rows().count() > 0) {
                // At least one row exists, add the class
                button.classList.add('active');
            } else {
                // No rows, remove the class
                button.classList.remove('active');
            }
        }

        // Function to add a new row to the DataTable
        function addDataRow() {
            let warehouse = $('#warehouse').val();
            let family = $('#family').val();
            let obs = $('#obs').val();
            let suplier = $('#suplier').val();
            let component = $('#component').val();
            // Add a new row to the DataTable
            toggleButtonClass()

            var rowNode = table.row.add([name, reference, qtd, '<button class="edit btn btn-warning">Editar</button> <button class="btn btn-danger delete">Remover</button>']).draw().node();

            $(rowNode).data('originalData', {warehouse: warehouse, family: family, obs: obs,suplier:suplier,component:component});

            // Clear the form fields
            $('#warehouse').val('');
            $('#component').val('');
            $('#family').val('');
            $('#obs').val('');
            $('#suplier').val('');
        }
        // Function to edit a row in the DataTable
        function editDataRow(data) {
            $('#warehouse').val(data.warehouse);
            $('#family').val(data.family);
            $('#obs').val(data.obs);
            $('#suplier').val(data.suplier);
            $('#component').val(data.component);

        }
    </script>
{% endblock %}
{#{% block formContent %}#}
{#     <div class="container pt-4">#}
{##}
{#    <div class="table-responsive">#}
{#      <table class="table table-bordered">#}
{#        <thead>#}
{#          <tr>#}
{#            <th class="text-center">Componente</th>#}
{#            <th class="text-center">Referência</th>#}
{#            <th class="text-center">Qtd</th>#}
{#            <th class="text-center">Opções</th>#}
{#          </tr>#}
{#        </thead>#}
{#        <tbody id="tbody">#}
{##}
{#        </tbody>#}
{#      </table>#}
{#    </div>#}
{#    <button class="btn btn-md btn-primary"#}
{#      id="addBtn" type="button">#}
{#        Adcionar Produto#}
{#    </button>#}
{#  </div>#}
{#    <script>#}
{#    $(document).ready(function () {#}
{##}
{#      // Denotes total number of rows#}
{#      var rowIdx = 0;#}
{##}
{#      // jQuery button click event to add a row#}
{#      $('#addBtn').on('click', function () {#}
{##}
{#        // Adding a row inside the tbody.#}
{#        $('#tbody').append(`<tr id="R${++rowIdx}">#}
{#             <td class="row-index text-center">#}
{#                <p>Motherboard Asus</p>#}
{#             </td>#}
{#               <td class="row-index text-center">#}
{#                <p>MB45-PRO</p>#}
{#             </td>#}
{#             <td class="row-index text-center">#}
{#                <p>4</p>#}
{#             </td>#}
{#              <td class="text-center">#}
{#                <button class="btn btn-danger remove"#}
{#                  type="button">Remover</button>#}
{#                <button class="btn btn-warning remove"#}
{#                  type="button">Alterar</button>#}
{#                </td>#}
{#              </tr>`);#}
{#      });#}
{##}
{#      // jQuery button click event to remove a row.#}
{#      $('#tbody').on('click', '.remove', function () {#}
{##}
{#        // Getting all the rows next to the row#}
{#        // containing the clicked button#}
{#        var child = $(this).closest('tr').nextAll();#}
{##}
{#        // Iterating across all the rows#}
{#        // obtained to change the index#}
{#        child.each(function () {#}
{##}
{#          // Getting <tr> id.#}
{#          var id = $(this).attr('id');#}
{##}
{#          // Getting the <p> inside the .row-index class.#}
{#          var idx = $(this).children('.row-index').children('p');#}
{##}
{#          // Gets the row number from <tr> id.#}
{#          var dig = parseInt(id.substring(1));#}
{##}
{#          // Modifying row index.#}
{#          idx.html(`Row ${dig - 1}`);#}
{##}
{#          // Modifying row id.#}
{#          $(this).attr('id', `R${dig - 1}`);#}
{#        });#}
{##}
{#        // Removing the current row.#}
{#        $(this).closest('tr').remove();#}
{##}
{#        // Decreasing total number of rows by 1.#}
{#        rowIdx--;#}
{#      });#}
{#    });#}
{#  </script>#}
{#{% endblock %}#}



